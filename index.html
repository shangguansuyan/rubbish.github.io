<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rubbish Journals</title>
  <meta name="description" content="Rubbish journal series." />

  <style>
    :root{
      --bg:#ffffff;
      --fg:#111111;
      --muted:#636363;
      --line:#e7e7e7;
      --chip:#f4f4f4;
      --link:#0b57d0;
      --max:1260px;
      --radius:16px;
      --shadow:0 18px 44px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, Helvetica, sans-serif;
      background:var(--bg);
      color:var(--fg);
    }
    a{ text-decoration:none; color:inherit; }
    a:hover{ color:var(--link); }

    header{
      border-bottom:1px solid var(--line);
      background:#fff;
      position:sticky;
      top:0;
      z-index:10;
    }
    .wrap{
      max-width:var(--max);
      margin:0 auto;
      padding:22px 22px;
    }
    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:16px;
      flex-wrap:wrap;
    }
    .brand{
      display:flex;
      align-items:baseline;
      gap:12px;
      white-space:nowrap;
    }
    .brand h1{
      margin:0;
      font-size:22px;
      letter-spacing:.2px;
      font-weight:850;
    }
    .brand span{
      font-size:12px;
      background:var(--chip);
      border:1px solid var(--line);
      padding:4px 10px;
      border-radius:999px;
      color:#444;
    }

    .right{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .search input{
      width:340px;
      max-width:100%;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid var(--line);
      outline:none;
      font-size:14px;
      background:#fff;
    }
    .btn{
      border:1px solid #111;
      background:#111;
      color:#fff;
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
      white-space:nowrap;
    }
    .btn.secondary{
      border:1px solid var(--line);
      background:#fff;
      color:#111;
    }
    .btn:active{transform:translateY(1px)}
    .btn:disabled{opacity:.5; cursor:not-allowed}

    .hero{
      padding:34px 0 8px;
    }
    .hero h2{
      margin:0 0 10px;
      font-size:32px;
      letter-spacing:-.4px;
      font-weight:900;
    }
    .hero p{
      margin:0;
      color:var(--muted);
      font-size:15px;
      line-height:1.7;
      max-width:980px;
    }
    .chips{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:14px;
    }
    .chip{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      background:var(--chip);
      border:1px solid var(--line);
      color:#333;
      white-space:nowrap;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:20px;
      padding:24px 0 52px;
    }
    @media (max-width:1100px){ .grid{grid-template-columns:repeat(3,1fr);} }
    @media (max-width:820px){ .grid{grid-template-columns:repeat(2,1fr);} }
    @media (max-width:520px){ .grid{grid-template-columns:1fr;} }

    .card{
      border:1px solid var(--line);
      border-radius:var(--radius);
      overflow:hidden;
      background:#fff;
      transition: transform .12s ease, box-shadow .14s ease;
      display:flex;
      flex-direction:column;
      min-height:260px;
    }
    .card:hover{
      transform: translateY(-3px);
      box-shadow:var(--shadow);
    }
    .cover{
      width:100%;
      aspect-ratio:4/3;
      object-fit:cover;
      background:#f5f5f5;
      display:block;
    }
    .meta{ padding:16px; }
    .title{
      margin:0 0 8px;
      font-size:16px;
      font-weight:800;
      line-height:1.35;
    }
    .sub{
      margin:0;
      font-size:12.5px;
      color:var(--muted);
      word-break: break-word;
    }

    .status{
      font-size:13px;
      color:var(--muted);
      border-top:1px solid var(--line);
      padding:14px 0;
      white-space:pre-wrap;
    }

    /* Modal */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.35);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:100;
    }
    .modal{
      width:min(760px, 100%);
      background:#fff;
      border-radius:18px;
      border:1px solid rgba(0,0,0,.08);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .modalHeader{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding:14px 14px;
      border-bottom:1px solid var(--line);
    }
    .modalHeader h3{
      margin:0;
      font-size:16px;
      font-weight:900;
    }
    .iconBtn{
      border:1px solid var(--line);
      background:#fff;
      border-radius:999px;
      padding:8px 10px;
      cursor:pointer;
      font-size:13px;
    }
    .modalBody{
      padding:14px;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    @media (max-width:720px){ .modalBody{grid-template-columns:1fr;} }
    label{display:block; font-size:12px; color:#333; margin:0 0 6px;}
    input, textarea{
      width:100%;
      padding:10px 10px;
      border:1px solid var(--line);
      border-radius:12px;
      font-size:14px;
      outline:none;
    }
    textarea{min-height:86px; resize:vertical}
    .full{grid-column:1 / -1;}
    .hint{color:var(--muted); font-size:12.5px; line-height:1.6; margin:0;}
    .modalFooter{
      padding:14px;
      border-top:1px solid var(--line);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .msg{font-size:12.8px; color:var(--muted); white-space:pre-wrap; margin:0;}
    .msg.danger{color:#b00020;}
    .msg.ok{color:#0b7a2a;}
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <h1>Rubbish</h1><span>Journals</span>
      </div>

      <div class="right">
        <button class="btn secondary" id="btnBoard" type="button">Editorial Board</button>
        <button class="btn" id="btnJoin" type="button">Join the Editorial Board</button>
        <div class="search">
          <input id="q" type="search" placeholder="Search journals" autocomplete="off">
        </div>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <section class="hero">
      <h2>Rubbish journal series</h2>
      <p>
        The Rubbish series is dedicated to transparent reporting of boundary findings: well-controlled negative results,
        informative failures, reproducible anomalies, and method-anchored observations that deserve a permanent scholarly record.
      </p>
      <div class="chips">
        <span class="chip">Open access</span>
        <span class="chip">Methods & reproducibility</span>
        <span class="chip">Negative results</span>
        <span class="chip">Anomalies</span>
        <span class="chip">Lab notes</span>
      </div>
    </section>

    <section id="grid" class="grid" aria-live="polite"></section>
    <div id="status" class="status">Loading journals…</div>
  </div>
</main>

<!-- Join modal -->
<div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal">
    <div class="modalHeader">
      <h3 id="modalTitle">Join the Editorial Board</h3>
      <button class="iconBtn" id="btnClose" type="button">Close</button>
    </div>

    <div class="modalBody">
      <div>
        <label>Name (required)</label>
        <input id="mName" type="text" placeholder="Full name">
      </div>
      <div>
        <label>Email (required)</label>
        <input id="mEmail" type="email" placeholder="name@institution.edu">
      </div>

      <div class="full">
        <label>Affiliations (required)</label>
        <textarea id="mAff" placeholder="One per line&#10;Example: Anhui Medical University"></textarea>
      </div>

      <div>
        <label>Role (required)</label>
        <input id="mRole" type="text" placeholder="e.g., Editorial Board Member">
      </div>
      <div>
        <label>Interests (required)</label>
        <input id="mInterests" type="text" placeholder="e.g., Bioinformatics; Spatial omics">
      </div>

      <div class="full">
        <label>ORCID (required)</label>
        <input id="mOrcid" type="text" placeholder="0000-0002-1825-0097">
      </div>

      <div class="full">
        <p class="hint">
          After you click “Submit application”, a GitHub Issue draft will open in a new tab. Please submit the issue.
          The editorial board list will update automatically after review and workflow processing.
        </p>
      </div>
    </div>

    <div class="modalFooter">
      <p id="modalMsg" class="msg"></p>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <button class="btn secondary" id="btnCancel" type="button">Cancel</button>
        <button class="btn" id="btnSubmitMember" type="button">Submit application</button>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  // Data source repository (journals)
  const OWNER = "shangguansuyan";
  const REPO  = "rubbish";
  const BRANCH = "main";
  const apiRoot = `https://api.github.com/repos/${OWNER}/${REPO}/contents`;
  const rawRoot = `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}`;

  const grid = document.getElementById("grid");
  const status = document.getElementById("status");
  const q = document.getElementById("q");

  const btnBoard = document.getElementById("btnBoard");
  const btnJoin = document.getElementById("btnJoin");

  // Modal
  const overlay = document.getElementById("overlay");
  const btnClose = document.getElementById("btnClose");
  const btnCancel = document.getElementById("btnCancel");
  const btnSubmitMember = document.getElementById("btnSubmitMember");
  const modalMsg = document.getElementById("modalMsg");

  const mName = document.getElementById("mName");
  const mEmail = document.getElementById("mEmail");
  const mAff = document.getElementById("mAff");
  const mRole = document.getElementById("mRole");
  const mInterests = document.getElementById("mInterests");
  const mOrcid = document.getElementById("mOrcid");

  let journals = [];
  const isImage = (name) => /\.(png|jpe?g|webp|gif)$/i.test(name);

  const esc = (s)=>String(s).replace(/[&<>"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));

  async function fetchJSON(url){
    const res = await fetch(url, { headers:{ "Accept":"application/vnd.github+json" }});
    const text = await res.text();
    let data = null;
    try{ data = JSON.parse(text); }catch{}
    if(!res.ok){
      const msg = (data && data.message) ? data.message : text.slice(0,200);
      throw new Error(`HTTP ${res.status} ${res.statusText}\n${msg}`);
    }
    return data;
  }

  async function fetchText(url){
    const res = await fetch(url, { cache:"no-store" });
    if(!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
    return await res.text();
  }

  function setModalMsg(kind, text){
    modalMsg.className = "msg" + (kind==="danger" ? " danger" : kind==="ok" ? " ok" : "");
    modalMsg.textContent = text || "";
  }

  function openModal(){
    overlay.style.display = "flex";
    setModalMsg("muted", "");
    // focus
    setTimeout(()=>mName.focus(), 0);
  }
  function closeModal(){
    overlay.style.display = "none";
    setModalMsg("muted", "");
  }

  function normalizeOrcid(orcid){
    const s = (orcid||"").trim();
    // allow with hyphens; enforce 16 digits with hyphens typical
    const m = s.match(/(\d{4}-\d{4}-\d{4}-\d{3}[\dX])/i);
    return m ? m[1] : s;
  }

  btnBoard.addEventListener("click", ()=> location.href = "editorial-board.html");
  btnJoin.addEventListener("click", openModal);
  btnClose.addEventListener("click", closeModal);
  btnCancel.addEventListener("click", closeModal);
  overlay.addEventListener("click", (e)=>{ if(e.target === overlay) closeModal(); });
  window.addEventListener("keydown", (e)=>{ if(e.key==="Escape" && overlay.style.display==="flex") closeModal(); });

  btnSubmitMember.addEventListener("click", () => {
    const name = (mName.value||"").trim();
    const email = (mEmail.value||"").trim();
    const role = (mRole.value||"").trim();
    const interests = (mInterests.value||"").trim();
    const orcid = normalizeOrcid(mOrcid.value||"");

    const affLines = (mAff.value||"")
      .split(/\r?\n/)
      .map(x=>x.trim())
      .filter(Boolean);

    if(!name || !email || affLines.length===0 || !role || !interests || !orcid){
      setModalMsg("danger", "All fields are required: Name, Email, Affiliations, Role, Interests, ORCID.");
      return;
    }

    // Issue title must start with [MEMBER] for workflow
    const issueTitle = (`[MEMBER] ${name}`).slice(0, 180);

    // body lines parsed by workflow
    const body =
`NAME: ${name}
EMAIL: ${email}
AFFILIATIONS: ${affLines.join(" | ")}
ROLE: ${role}
INTERESTS: ${interests}
ORCID: ${orcid}

(Submitted from index page)`;

    const url = new URL(`https://github.com/${OWNER}/${REPO}/issues/new`);
    url.searchParams.set("title", issueTitle);
    url.searchParams.set("body", body);

    window.open(url.toString(), "_blank", "noopener");
    setModalMsg("ok", "A GitHub Issue draft has been opened in a new tab. Please submit it.");
  });

  function render(list){
    grid.innerHTML = list.map(j => `
      <a class="card" href="journal.html?j=${encodeURIComponent(j.folder)}" aria-label="Open ${esc(j.title)}">
        <img class="cover" src="${esc(j.coverUrl)}" alt="${esc(j.title)} cover" loading="lazy">
        <div class="meta">
          <p class="title">${esc(j.title)}</p>
          <p class="sub">${esc(j.folder)}</p>
        </div>
      </a>
    `).join("");
    status.textContent = `${list.length} journal(s)`;
  }

  function applyFilter(){
    const term = (q.value||"").trim().toLowerCase();
    if(!term){ render(journals); return; }
    render(journals.filter(j =>
      j.title.toLowerCase().includes(term) || j.folder.toLowerCase().includes(term)
    ));
  }

  async function load(){
    status.textContent = "Loading journals…";
    const rootItems = await fetchJSON(`${apiRoot}?ref=${encodeURIComponent(BRANCH)}`);
    const dirs = rootItems.filter(x=>x.type==="dir").map(x=>x.name).sort((a,b)=>a.localeCompare(b));

    const results = [];
    for(const folder of dirs){
      const items = await fetchJSON(`${apiRoot}/${encodeURIComponent(folder)}?ref=${encodeURIComponent(BRANCH)}`);
      const hasName = items.some(x=>x.type==="file" && x.name==="name.txt");
      if(!hasName) continue;

      const images = items.filter(x=>x.type==="file" && isImage(x.name)).sort((a,b)=>a.name.localeCompare(b.name));
      const coverUrl = images.length ? images[0].download_url : `data:image/svg+xml;charset=utf-8,${encodeURIComponent(
        `<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'>
          <rect width='100%' height='100%' fill='#f2f2f2'/>
          <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle'
            font-family='Arial' font-size='22' fill='#777'>No cover image</text>
        </svg>`
      )}`;

      let title = folder;
      try{
        const t = await fetchText(`${rawRoot}/${encodeURIComponent(folder)}/name.txt?t=${Date.now()}`);
        title = (t||"").trim() || folder;
      } catch {}

      results.push({ folder, title, coverUrl });
    }

    journals = results.sort((a,b)=>a.title.localeCompare(b.title));
    render(journals);
  }

  q.addEventListener("input", applyFilter);

  load().catch(err=>{
    console.error(err);
    status.textContent = `Failed to load journals.\n${String(err.message || err)}`;
  });
})();
</script>
</body>
</html>
