<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rubbish Journals</title>
  <meta name="description" content="Rubbish journal collection." />

  <style>
    :root{
      --bg:#ffffff;
      --fg:#111111;
      --muted:#6a6a6a;
      --line:#e6e6e6;
      --chip:#f4f4f4;
      --link:#0b57d0;
      --max:1250px;
      --radius:16px;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, Helvetica, sans-serif;
      background:var(--bg);
      color:var(--fg);
    }

    a{
      text-decoration:none;
      color:inherit;
    }

    a:hover{
      color:var(--link);
    }

    header{
      border-bottom:1px solid var(--line);
      background:#fff;
      position:sticky;
      top:0;
      z-index:10;
    }

    .wrap{
      max-width:var(--max);
      margin:0 auto;
      padding:22px 22px;
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:20px;
      flex-wrap:wrap;
    }

    .brand{
      display:flex;
      align-items:baseline;
      gap:12px;
    }

    .brand h1{
      margin:0;
      font-size:22px;
      letter-spacing:.3px;
    }

    .brand span{
      font-size:12px;
      background:var(--chip);
      border:1px solid var(--line);
      padding:4px 10px;
      border-radius:999px;
      color:#444;
    }

    .search input{
      width:320px;
      max-width:100%;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid var(--line);
      outline:none;
      font-size:14px;
    }

    .hero{
      padding:30px 0 10px;
    }

    .hero h2{
      margin:0 0 10px;
      font-size:30px;
      letter-spacing:-.3px;
    }

    .hero p{
      margin:0;
      color:var(--muted);
      font-size:15px;
      line-height:1.6;
      max-width:700px;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:20px;
      padding:30px 0 50px;
    }

    @media (max-width:1100px){
      .grid{grid-template-columns:repeat(3,1fr);}
    }

    @media (max-width:800px){
      .grid{grid-template-columns:repeat(2,1fr);}
    }

    @media (max-width:520px){
      .grid{grid-template-columns:1fr;}
    }

    .card{
      border:1px solid var(--line);
      border-radius:var(--radius);
      overflow:hidden;
      background:#fff;
      transition:.15s ease;
      display:flex;
      flex-direction:column;
    }

    .card:hover{
      transform:translateY(-4px);
      box-shadow:0 16px 40px rgba(0,0,0,.08);
    }

    .cover{
      width:100%;
      aspect-ratio:4/3;
      object-fit:cover;
      background:#f5f5f5;
    }

    .meta{
      padding:16px;
    }

    .title{
      margin:0 0 8px;
      font-size:16px;
      font-weight:700;
      line-height:1.4;
    }

    .folder{
      font-size:12px;
      color:var(--muted);
    }

    .status{
      font-size:13px;
      color:var(--muted);
      border-top:1px solid var(--line);
      padding:14px 0;
    }
  </style>
</head>

<body>

<header>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <h1>Rubbish</h1>
        <span>Journals</span>
      </div>
      <div class="search">
        <input id="q" type="search" placeholder="Search journals" autocomplete="off">
      </div>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <section class="hero">
      <h2>Explore the Rubbish journal series</h2>
      <p>
        Select a journal to browse published articles and submission information.
        The homepage does not provide submission functionality.
      </p>
    </section>

    <section id="grid" class="grid"></section>

    <div id="status" class="status">Loading journalsâ€¦</div>
  </div>
</main>

<script>
(() => {

  // ==== DATA SOURCE REPOSITORY ====
  const OWNER = "shangguansuyan";
  const REPO  = "rubbish";
  const BRANCH = "main";

  const apiRoot = `https://api.github.com/repos/${OWNER}/${REPO}/contents`;

  const grid = document.getElementById("grid");
  const status = document.getElementById("status");
  const searchInput = document.getElementById("q");

  let journals = [];

  const isImage = name => /\.(png|jpg|jpeg|webp|gif)$/i.test(name);

  function escapeHTML(str){
    return str.replace(/[&<>"']/g, m => ({
      "&":"&amp;",
      "<":"&lt;",
      ">":"&gt;",
      "\"":"&quot;",
      "'":"&#39;"
    })[m]);
  }

  async function fetchJSON(url){
    const res = await fetch(url, {
      headers: { "Accept":"application/vnd.github+json" }
    });
    if(!res.ok) throw new Error(res.status);
    return await res.json();
  }

  async function readName(folder){
    try{
      const item = await fetchJSON(`${apiRoot}/${folder}/name.txt?ref=${BRANCH}`);
      return atob(item.content.replace(/\n/g,"")).trim();
    }catch{
      return folder;
    }
  }

  async function readCover(folder){
    try{
      const files = await fetchJSON(`${apiRoot}/${folder}?ref=${BRANCH}`);
      const img = files.find(f => f.type==="file" && isImage(f.name));
      return img ? img.download_url : "";
    }catch{
      return "";
    }
  }

  function render(list){
    grid.innerHTML = list.map(j => `
      <a class="card" href="journal.html?j=${encodeURIComponent(j.folder)}">
        <img class="cover" src="${j.cover || ''}">
        <div class="meta">
          <p class="title">${escapeHTML(j.title)}</p>
          <p class="folder">${escapeHTML(j.folder)}</p>
        </div>
      </a>
    `).join("");

    status.textContent = `${list.length} journal(s)`;
  }

  function applySearch(){
    const term = searchInput.value.toLowerCase().trim();
    if(!term){
      render(journals);
      return;
    }
    const filtered = journals.filter(j =>
      j.title.toLowerCase().includes(term) ||
      j.folder.toLowerCase().includes(term)
    );
    render(filtered);
  }

  async function load(){
    const root = await fetchJSON(`${apiRoot}?ref=${BRANCH}`);
    const folders = root.filter(x => x.type==="dir").map(x => x.name);

    const result = [];
    for(const folder of folders){
      const [title, cover] = await Promise.all([
        readName(folder),
        readCover(folder)
      ]);
      result.push({ folder, title, cover });
    }

    journals = result.sort((a,b)=>a.title.localeCompare(b.title));
    render(journals);
  }

  searchInput.addEventListener("input", applySearch);

  load().catch(e=>{
    status.textContent = "Failed to load journals.";
    console.error(e);
  });

})();
</script>

</body>
</html>
